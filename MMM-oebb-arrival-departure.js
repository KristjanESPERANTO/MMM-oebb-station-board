/** 
 * ÖBB Station Arrivals & Departures
 * Show arrivals and departures of a specific ÖBB station
 * 
 * Version 0.0.0
 * By Michael Scharl <michael.scharl@me.com>
 * 
 * License MIT
 * 
 * This is an autogenerated file. DO NOT EDIT!
 */
(function () {
    'use strict';

    var GET_STATION_DATA = 'get_station_data';
    var RECEIVED_STATION_DATA = 'received_station_data';

    var DOM_INSTANCES = {};
    Module.register('MMM-oebb-arrival-departure', {
        /**
         * Define the default instance config
         */
        defaults: {},
        start: function () {
            this.loading = true;
            this.stationData = null;
            this.sendSocketNotification(GET_STATION_DATA, this.config.stationNumber);
        },
        /**
         * Core-Function to return the modules DOM-Tree.
         */
        getDom: function () {
            var _a = this._getDomInstance(), root = _a.root, header = _a.header, table = _a.table, createRow = _a.createRow;
            var data = this.stationData;
            console.log(data);
            table.innerHTML = '';
            if (this.loading) {
                header.innerText = 'Loading station data …';
            }
            else if (!data) {
                header.innerText = 'No data available!';
            }
            else {
                header.innerText = data.stationName;
                table.append.apply(table, data.journey.map(function (train) {
                    var _a = createRow(), row = _a.row, time = _a.time, timeCorrection = _a.timeCorrection, id = _a.id, destination = _a.destination, platform = _a.platform;
                    time.innerText = train.ti;
                    id.innerText = train.pr;
                    destination.innerText = train.lastStop;
                    platform.innerText = train.tr;
                    if (train.rt) {
                        timeCorrection.innerText = train.rt.dlt;
                    }
                    return row;
                }));
            }
            return root;
        },
        socketNotificationReceived: function (notification, payload) {
            switch (notification) {
                case RECEIVED_STATION_DATA:
                    this.stationData = payload;
                    this.loading = false;
                    this.updateDom();
                    break;
            }
        },
        _getDomInstance: function () {
            var identifier = this.identifier;
            // Create DOM Elements only if not created before.
            if (!DOM_INSTANCES[identifier]) {
                var root = document.createElement('div');
                var header = document.createElement('header');
                var table = document.createElement('table');
                var createRow = function () {
                    var row = document.createElement('tr');
                    var time = document.createElement('td');
                    var timeCorrection = document.createElement('td');
                    var id = document.createElement('td');
                    var destination = document.createElement('td');
                    var platform = document.createElement('td');
                    row.append(time, timeCorrection, id, destination, platform);
                    return {
                        row: row,
                        time: time,
                        timeCorrection: timeCorrection,
                        id: id,
                        destination: destination,
                        platform: platform,
                    };
                };
                root.append(header, table);
                DOM_INSTANCES[identifier] = {
                    root: root,
                    header: header,
                    table: table,
                    createRow: createRow,
                };
            }
            return DOM_INSTANCES[identifier];
        },
    });

}());
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTU1NLW9lYmItYXJyaXZhbC1kZXBhcnR1cmUuanMiLCJzb3VyY2VzIjpbXSwic291cmNlc0NvbnRlbnQiOltdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiIn0=
